C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE NAVIGATION
OBJECT MODULE PLACED IN .\DP8051_Keil_903\Debug\navigation.obj
COMPILER INVOKED BY: C:\Program Files\Cypress\PSoC Creator\2.1\PSoC Creator\import\keil\pk51\9.03\C51\BIN\c51.exe .\navi
                    -gation.c NOIV LARGE MODDP2 OMF2 VB(1) PR(.\DP8051_Keil_903\Debug\navigation.lst) CD DB NOIP OT(0) INCDIR(Generated_Sourc
                    -e\PSoC3) OJ(.\DP8051_Keil_903\Debug\navigation.obj)

line level    source

   1          /******************************************************************************
   2           * File Name: navigation.c
   3           * Version 1.1
   4           * 
   5           * Authors: Jenny & Allie
   6           * 
   7           * Description:
   8           * Speed Control using PI control
   9           * 
  10           * Dependencies: stdio.h, device.h, speedcontrol.h
  11           * 
  12           * Code Tested with: 
  13           * PSoC Creator: PSoC Creator 2.1
  14           * Device tested with: CY8C3866AXI-040 
  15           * Compiler: DP8051 Keil 8.16
  16          *******************************************************************************/
  17          
  18          #include <device.h>
  19          #include "navigation.h"
  20          
  21          /* GLOBAL VARIABLES */
  22          double navintegralSum = 0;     // discrete sum of integral
  23          double navprevTime = 0;
  24          double navthisTime = 0;
  25          double navprevError = 0;
  26          double navthisError = 0;
  27          double errorCount = 0;
  28          
  29          /*-----------------------------------------*/
  30          // navigation control initializations
  31          void nav_Start() {
  32   1          FrameInterrupt_Start();               
  33   1          FrameInterrupt_SetVector(interFrame);
  34   1          TapeInterrupt_Start();                  // start timer for tape position
  35   1          TapeInterrupt_SetVector(interTape);
  36   1          TapeTimer_Start();  
  37   1          CVComp_Start();                         // start CVComp
  38   1          LineCounter_Start();
  39   1          ServoPWM_Start();                       // start ServoPWM
  40   1          ServoPWM_WriteCompare(140);             // initial cycle PWM pulse-width
  41   1      }
  42          
  43          /*-----------------------------------------*/
  44          // navigation control initializations
  45          void nav_Stop() {
  46   1          ServoPWM_Stop();
  47   1      }
  48              
  49          /*-----------------------------------------*/
  50          // black tape interrupt handler
  51          CY_ISR(interTape) {
  52   1          uint8 cmp;                             // CMP value for PWM
  53   1          double begin = (double) navTimer();
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 2   

  54   1          double time1 = (double) navTimer(); // time that the camera saw the tape
  55   1          double time2 = (double) navTimer();
  56   1          double end = (double) navTimer();
  57   1          double time =  begin - ((time1 + time2) / 2);
  58   1      
  59   1          if ((begin - end) > .000049 && (begin - end) < .000052)
  60   1              cmp = navPIDControl(time);
  61   1      
  62   1          // WRITE new pulse width based on PID after each pulse
  63   1          ServoPWM_WriteCompare(cmp);
  64   1      }
  65          
  66          /*-----------------------------------------*/
  67          // line interrupt handler
  68          CY_ISR(interFrame) {
  69   1          TapeTimer_ClearFIFO();
  70   1      }
  71          
  72          /*---------------------------------------------------------------------------*/
  73          // returns current timer reading in seconds
  74          double navTimer() {
  75   1          float clkSpeed = 1000000.0; // in Hz
  76   1          float time = (float)TapeTimer_ReadCapture() / clkSpeed;
  77   1          SensorTimer_ReadStatusRegister();
  78   1          
  79   1          return (double)time;
  80   1      }
  81          /*---------------------------------------------------------------------------*/
  82          // calculate error for goal speed
  83          double navError(double time) {
  84   1          double TIMEGOAL = 0.0000243; // calibrated goal time for displacement = 25.4.1us
  85   1          double error = TIMEGOAL - time;
  86   1          
  87   1          if (errorCount == 5) {
  88   2              navprevError = navthisError;
  89   2              navthisError = error;
  90   2              navprevTime = time;
  91   2              navthisTime = time;
  92   2          }
  93   1          
  94   1          return TIMEGOAL - time;
  95   1      }
  96          
  97          /*---------------------------------------------------------------------------*/
  98          // integration control
  99          void navIControl(double dT, double error) {
 100   1          navintegralSum += error * dT;
 101   1      }
 102          
 103          /*---------------------------------------------------------------------------*/
 104          // derivative control
 105          double navDControl(double time) {
 106   1          double dD = (navthisError - navprevError) / (time - navprevTime) ;
 107   1          return dD;
 108   1      }
 109          
 110          /*---------------------------------------------------------------------------*/
 111          // PID control method returning CMP value for PWM
 112          uint8 navPIDControl(double time) { 
 113   1          double cmp;                     // CMP value for servoPWM_WriteCompare param
 114   1          double periodPWM = 1000;        // period of motorPWM component
 115   1          double openLoop = 150;          // open loop control constant 
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 3   

 116   1          double navKp = 15;              // constant for P control 
 117   1          double navKi = 0;               // constant for I control
 118   1          double navKd = 7;               // constant for D control
 119   1          double error = navError(time);  // PID error
 120   1          
 121   1          /* PID control calculation */
 122   1          cmp = openLoop - 100000*(navKp * error) + navKi * navintegralSum; // only contains PI for now
 123   1      
 124   1          // set bounds for cmp
 125   1          if (cmp < 110) cmp = 110;
 126   1          else if (cmp > 190) cmp = 190;
 127   1          
 128   1          // return CMP value for sensorPWM_WriteCompare input param
 129   1          return (uint8)cmp;
 130   1      }
 131          
 132          /*-----------------------------------------*/
 133          /* [] END OF FILE */
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 4   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION nav_Start (BEGIN)
                                           ; SOURCE LINE # 31
                                           ; SOURCE LINE # 32
0000 120000      E     LCALL   FrameInterrupt_Start
                                           ; SOURCE LINE # 33
0003 7E00        R     MOV     R6,#HIGH interFrame
0005 7F00        R     MOV     R7,#LOW interFrame
0007 120000      E     LCALL   _FrameInterrupt_SetVector
                                           ; SOURCE LINE # 34
000A 120000      E     LCALL   TapeInterrupt_Start
                                           ; SOURCE LINE # 35
000D 7E00        R     MOV     R6,#HIGH interTape
000F 7F00        R     MOV     R7,#LOW interTape
0011 120000      E     LCALL   _TapeInterrupt_SetVector
                                           ; SOURCE LINE # 36
0014 120000      E     LCALL   TapeTimer_Start
                                           ; SOURCE LINE # 37
0017 120000      E     LCALL   CVComp_Start
                                           ; SOURCE LINE # 38
001A 120000      E     LCALL   LineCounter_Start
                                           ; SOURCE LINE # 39
001D 120000      E     LCALL   ServoPWM_Start
                                           ; SOURCE LINE # 40
0020 7F8C              MOV     R7,#08CH
0022 7E00              MOV     R6,#00H
0024 120000      E     LCALL   _ServoPWM_WriteCompare
                                           ; SOURCE LINE # 41
0027         ?C0001:
0027 22                RET     
             ; FUNCTION nav_Start (END)

             ; FUNCTION nav_Stop (BEGIN)
                                           ; SOURCE LINE # 45
                                           ; SOURCE LINE # 46
0000 120000      E     LCALL   ServoPWM_Stop
                                           ; SOURCE LINE # 47
0003         ?C0002:
0003 22                RET     
             ; FUNCTION nav_Stop (END)

             ; FUNCTION interTape (BEGIN)
0000 C0E0              PUSH    ACC
0002 C0F0              PUSH    B
0004 C083              PUSH    DPH
0006 C082              PUSH    DPL
0008 C085              PUSH    DPH1
000A C084              PUSH    DPL1
000C C086              PUSH    DPS
000E 758600            MOV     DPS,#00H
0011 C000        E     PUSH    ?C?XPAGE1SFR
0013 750000      E     MOV     ?C?XPAGE1SFR,#?C?XPAGE1RST
0016 C0D0              PUSH    PSW
0018 75D000            MOV     PSW,#00H
001B C000              PUSH    AR0
001D C001              PUSH    AR1
001F C002              PUSH    AR2
0021 C003              PUSH    AR3
0023 C004              PUSH    AR4
0025 C005              PUSH    AR5
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 5   

0027 C006              PUSH    AR6
0029 C007              PUSH    AR7
                                           ; SOURCE LINE # 51
                                           ; SOURCE LINE # 53
002B 120000      R     LCALL   navTimer
002E 900000      R     MOV     DPTR,#begin
0031 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 54
0034 120000      R     LCALL   navTimer
0037 900000      R     MOV     DPTR,#time1
003A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 55
003D 120000      R     LCALL   navTimer
0040 900000      R     MOV     DPTR,#time2
0043 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 56
0046 120000      R     LCALL   navTimer
0049 900000      R     MOV     DPTR,#end
004C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 57
004F 900000      R     MOV     DPTR,#time2
0052 E0                MOVX    A,@DPTR
0053 FC                MOV     R4,A
0054 A3                INC     DPTR
0055 E0                MOVX    A,@DPTR
0056 FD                MOV     R5,A
0057 A3                INC     DPTR
0058 E0                MOVX    A,@DPTR
0059 FE                MOV     R6,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
005C FF                MOV     R7,A
005D 900000      R     MOV     DPTR,#time1
0060 E0                MOVX    A,@DPTR
0061 F8                MOV     R0,A
0062 A3                INC     DPTR
0063 E0                MOVX    A,@DPTR
0064 F9                MOV     R1,A
0065 A3                INC     DPTR
0066 E0                MOVX    A,@DPTR
0067 FA                MOV     R2,A
0068 A3                INC     DPTR
0069 E0                MOVX    A,@DPTR
006A FB                MOV     R3,A
006B 120000      E     LCALL   ?C?FPADD
006E 7B00              MOV     R3,#00H
0070 7A00              MOV     R2,#00H
0072 7900              MOV     R1,#00H
0074 7840              MOV     R0,#040H
0076 120000      E     LCALL   ?C?FPDIV
0079 A804              MOV     R0,AR4
007B A905              MOV     R1,AR5
007D AA06              MOV     R2,AR6
007F AB07              MOV     R3,AR7
0081 900000      R     MOV     DPTR,#begin
0084 E0                MOVX    A,@DPTR
0085 FC                MOV     R4,A
0086 A3                INC     DPTR
0087 E0                MOVX    A,@DPTR
0088 FD                MOV     R5,A
0089 A3                INC     DPTR
008A E0                MOVX    A,@DPTR
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 6   

008B FE                MOV     R6,A
008C A3                INC     DPTR
008D E0                MOVX    A,@DPTR
008E FF                MOV     R7,A
008F 120000      E     LCALL   ?C?FPSUB
0092 900000      R     MOV     DPTR,#time
0095 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 59
0098 900000      R     MOV     DPTR,#end
009B E0                MOVX    A,@DPTR
009C F8                MOV     R0,A
009D A3                INC     DPTR
009E E0                MOVX    A,@DPTR
009F F9                MOV     R1,A
00A0 A3                INC     DPTR
00A1 E0                MOVX    A,@DPTR
00A2 FA                MOV     R2,A
00A3 A3                INC     DPTR
00A4 E0                MOVX    A,@DPTR
00A5 FB                MOV     R3,A
00A6 900000      R     MOV     DPTR,#begin
00A9 E0                MOVX    A,@DPTR
00AA FC                MOV     R4,A
00AB A3                INC     DPTR
00AC E0                MOVX    A,@DPTR
00AD FD                MOV     R5,A
00AE A3                INC     DPTR
00AF E0                MOVX    A,@DPTR
00B0 FE                MOV     R6,A
00B1 A3                INC     DPTR
00B2 E0                MOVX    A,@DPTR
00B3 FF                MOV     R7,A
00B4 120000      E     LCALL   ?C?FPSUB
00B7 7B59              MOV     R3,#059H
00B9 7A85              MOV     R2,#085H
00BB 794D              MOV     R1,#04DH
00BD 7838              MOV     R0,#038H
00BF 120000      E     LCALL   ?C?FPCMP3
00C2 5044              JNC     ?C0003
00C4 900000      R     MOV     DPTR,#end
00C7 E0                MOVX    A,@DPTR
00C8 F8                MOV     R0,A
00C9 A3                INC     DPTR
00CA E0                MOVX    A,@DPTR
00CB F9                MOV     R1,A
00CC A3                INC     DPTR
00CD E0                MOVX    A,@DPTR
00CE FA                MOV     R2,A
00CF A3                INC     DPTR
00D0 E0                MOVX    A,@DPTR
00D1 FB                MOV     R3,A
00D2 900000      R     MOV     DPTR,#begin
00D5 E0                MOVX    A,@DPTR
00D6 FC                MOV     R4,A
00D7 A3                INC     DPTR
00D8 E0                MOVX    A,@DPTR
00D9 FD                MOV     R5,A
00DA A3                INC     DPTR
00DB E0                MOVX    A,@DPTR
00DC FE                MOV     R6,A
00DD A3                INC     DPTR
00DE E0                MOVX    A,@DPTR
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 7   

00DF FF                MOV     R7,A
00E0 120000      E     LCALL   ?C?FPSUB
00E3 7B93              MOV     R3,#093H
00E5 7A1A              MOV     R2,#01AH
00E7 795A              MOV     R1,#05AH
00E9 7838              MOV     R0,#038H
00EB 120000      E     LCALL   ?C?FPCMP3
00EE 6018              JZ      ?C0003
00F0 4016              JC      ?C0003
                                           ; SOURCE LINE # 60
00F2 900000      R     MOV     DPTR,#time
00F5 E0                MOVX    A,@DPTR
00F6 FC                MOV     R4,A
00F7 A3                INC     DPTR
00F8 E0                MOVX    A,@DPTR
00F9 FD                MOV     R5,A
00FA A3                INC     DPTR
00FB E0                MOVX    A,@DPTR
00FC FE                MOV     R6,A
00FD A3                INC     DPTR
00FE E0                MOVX    A,@DPTR
00FF FF                MOV     R7,A
0100 120000      R     LCALL   _navPIDControl
0103 900000      R     MOV     DPTR,#cmp
0106 EF                MOV     A,R7
0107 F0                MOVX    @DPTR,A
0108         ?C0003:
                                           ; SOURCE LINE # 63
0108 900000      R     MOV     DPTR,#cmp
010B E0                MOVX    A,@DPTR
010C FF                MOV     R7,A
010D 7E00              MOV     R6,#00H
010F 120000      E     LCALL   _ServoPWM_WriteCompare
                                           ; SOURCE LINE # 64
0112         ?C0004:
0112 D007              POP     AR7
0114 D006              POP     AR6
0116 D005              POP     AR5
0118 D004              POP     AR4
011A D003              POP     AR3
011C D002              POP     AR2
011E D001              POP     AR1
0120 D000              POP     AR0
0122 D0D0              POP     PSW
0124 D000        E     POP     ?C?XPAGE1SFR
0126 D086              POP     DPS
0128 D084              POP     DPL1
012A D085              POP     DPH1
012C D082              POP     DPL
012E D083              POP     DPH
0130 D0F0              POP     B
0132 D0E0              POP     ACC
0134 32                RETI    
             ; FUNCTION interTape (END)

             ; FUNCTION interFrame (BEGIN)
0000 C0E0              PUSH    ACC
0002 C0F0              PUSH    B
0004 C083              PUSH    DPH
0006 C082              PUSH    DPL
0008 C085              PUSH    DPH1
000A C084              PUSH    DPL1
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 8   

000C C086              PUSH    DPS
000E 758600            MOV     DPS,#00H
0011 C000        E     PUSH    ?C?XPAGE1SFR
0013 750000      E     MOV     ?C?XPAGE1SFR,#?C?XPAGE1RST
0016 C0D0              PUSH    PSW
0018 75D000            MOV     PSW,#00H
001B C000              PUSH    AR0
001D C001              PUSH    AR1
001F C002              PUSH    AR2
0021 C003              PUSH    AR3
0023 C004              PUSH    AR4
0025 C005              PUSH    AR5
0027 C006              PUSH    AR6
0029 C007              PUSH    AR7
                                           ; SOURCE LINE # 68
                                           ; SOURCE LINE # 69
002B 120000      E     LCALL   TapeTimer_ClearFIFO
                                           ; SOURCE LINE # 70
002E         ?C0005:
002E D007              POP     AR7
0030 D006              POP     AR6
0032 D005              POP     AR5
0034 D004              POP     AR4
0036 D003              POP     AR3
0038 D002              POP     AR2
003A D001              POP     AR1
003C D000              POP     AR0
003E D0D0              POP     PSW
0040 D000        E     POP     ?C?XPAGE1SFR
0042 D086              POP     DPS
0044 D084              POP     DPL1
0046 D085              POP     DPH1
0048 D082              POP     DPL
004A D083              POP     DPH
004C D0F0              POP     B
004E D0E0              POP     ACC
0050 32                RETI    
             ; FUNCTION interFrame (END)

             ; FUNCTION navTimer (BEGIN)
                                           ; SOURCE LINE # 74
                                           ; SOURCE LINE # 75
0000 7F00              MOV     R7,#00H
0002 7E24              MOV     R6,#024H
0004 7D74              MOV     R5,#074H
0006 7C49              MOV     R4,#049H
0008 900000      R     MOV     DPTR,#clkSpeed
000B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 76
000E 120000      E     LCALL   TapeTimer_ReadCapture
0011 E4                CLR     A
0012 120000      E     LCALL   ?C?FCASTL
0015 900000      R     MOV     DPTR,#clkSpeed
0018 E0                MOVX    A,@DPTR
0019 F8                MOV     R0,A
001A A3                INC     DPTR
001B E0                MOVX    A,@DPTR
001C F9                MOV     R1,A
001D A3                INC     DPTR
001E E0                MOVX    A,@DPTR
001F FA                MOV     R2,A
0020 A3                INC     DPTR
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 9   

0021 E0                MOVX    A,@DPTR
0022 FB                MOV     R3,A
0023 120000      E     LCALL   ?C?FPDIV
0026 900000      R     MOV     DPTR,#time
0029 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 77
002C 120000      E     LCALL   SensorTimer_ReadStatusRegister
                                           ; SOURCE LINE # 79
002F 900000      R     MOV     DPTR,#time
0032 E0                MOVX    A,@DPTR
0033 FC                MOV     R4,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 FD                MOV     R5,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FE                MOV     R6,A
003A A3                INC     DPTR
003B E0                MOVX    A,@DPTR
003C FF                MOV     R7,A
                                           ; SOURCE LINE # 80
003D         ?C0006:
003D 22                RET     
             ; FUNCTION navTimer (END)

             ; FUNCTION _navError (BEGIN)
                                           ; SOURCE LINE # 83
0000 900000      R     MOV     DPTR,#time
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 84
0006 7FDA              MOV     R7,#0DAH
0008 7ED7              MOV     R6,#0D7H
000A 7DCB              MOV     R5,#0CBH
000C 7C37              MOV     R4,#037H
000E 900000      R     MOV     DPTR,#TIMEGOAL
0011 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 85
0014 900000      R     MOV     DPTR,#time
0017 E0                MOVX    A,@DPTR
0018 F8                MOV     R0,A
0019 A3                INC     DPTR
001A E0                MOVX    A,@DPTR
001B F9                MOV     R1,A
001C A3                INC     DPTR
001D E0                MOVX    A,@DPTR
001E FA                MOV     R2,A
001F A3                INC     DPTR
0020 E0                MOVX    A,@DPTR
0021 FB                MOV     R3,A
0022 900000      R     MOV     DPTR,#TIMEGOAL
0025 E0                MOVX    A,@DPTR
0026 FC                MOV     R4,A
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 FD                MOV     R5,A
002A A3                INC     DPTR
002B E0                MOVX    A,@DPTR
002C FE                MOV     R6,A
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F FF                MOV     R7,A
0030 120000      E     LCALL   ?C?FPSUB
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 10  

0033 900000      R     MOV     DPTR,#error
0036 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 87
0039 7F00              MOV     R7,#00H
003B 7E00              MOV     R6,#00H
003D 7DA0              MOV     R5,#0A0H
003F 7C40              MOV     R4,#040H
0041 900000      R     MOV     DPTR,#errorCount
0044 E0                MOVX    A,@DPTR
0045 F8                MOV     R0,A
0046 A3                INC     DPTR
0047 E0                MOVX    A,@DPTR
0048 F9                MOV     R1,A
0049 A3                INC     DPTR
004A E0                MOVX    A,@DPTR
004B FA                MOV     R2,A
004C A3                INC     DPTR
004D E0                MOVX    A,@DPTR
004E FB                MOV     R3,A
004F 120000      E     LCALL   ?C?FPCMP3
0052 7050              JNZ     ?C0007
                                           ; SOURCE LINE # 88
0054 900000      R     MOV     DPTR,#navthisError
0057 E0                MOVX    A,@DPTR
0058 FC                MOV     R4,A
0059 A3                INC     DPTR
005A E0                MOVX    A,@DPTR
005B FD                MOV     R5,A
005C A3                INC     DPTR
005D E0                MOVX    A,@DPTR
005E FE                MOV     R6,A
005F A3                INC     DPTR
0060 E0                MOVX    A,@DPTR
0061 FF                MOV     R7,A
0062 900000      R     MOV     DPTR,#navprevError
0065 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 89
0068 900000      R     MOV     DPTR,#error
006B E0                MOVX    A,@DPTR
006C FC                MOV     R4,A
006D A3                INC     DPTR
006E E0                MOVX    A,@DPTR
006F FD                MOV     R5,A
0070 A3                INC     DPTR
0071 E0                MOVX    A,@DPTR
0072 FE                MOV     R6,A
0073 A3                INC     DPTR
0074 E0                MOVX    A,@DPTR
0075 FF                MOV     R7,A
0076 900000      R     MOV     DPTR,#navthisError
0079 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 90
007C 900000      R     MOV     DPTR,#time
007F E0                MOVX    A,@DPTR
0080 FC                MOV     R4,A
0081 A3                INC     DPTR
0082 E0                MOVX    A,@DPTR
0083 FD                MOV     R5,A
0084 A3                INC     DPTR
0085 E0                MOVX    A,@DPTR
0086 FE                MOV     R6,A
0087 A3                INC     DPTR
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 11  

0088 E0                MOVX    A,@DPTR
0089 FF                MOV     R7,A
008A 900000      R     MOV     DPTR,#navprevTime
008D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 91
0090 900000      R     MOV     DPTR,#time
0093 E0                MOVX    A,@DPTR
0094 FC                MOV     R4,A
0095 A3                INC     DPTR
0096 E0                MOVX    A,@DPTR
0097 FD                MOV     R5,A
0098 A3                INC     DPTR
0099 E0                MOVX    A,@DPTR
009A FE                MOV     R6,A
009B A3                INC     DPTR
009C E0                MOVX    A,@DPTR
009D FF                MOV     R7,A
009E 900000      R     MOV     DPTR,#navthisTime
00A1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 92
00A4         ?C0007:
                                           ; SOURCE LINE # 94
00A4 900000      R     MOV     DPTR,#time
00A7 E0                MOVX    A,@DPTR
00A8 F8                MOV     R0,A
00A9 A3                INC     DPTR
00AA E0                MOVX    A,@DPTR
00AB F9                MOV     R1,A
00AC A3                INC     DPTR
00AD E0                MOVX    A,@DPTR
00AE FA                MOV     R2,A
00AF A3                INC     DPTR
00B0 E0                MOVX    A,@DPTR
00B1 FB                MOV     R3,A
00B2 900000      R     MOV     DPTR,#TIMEGOAL
00B5 E0                MOVX    A,@DPTR
00B6 FC                MOV     R4,A
00B7 A3                INC     DPTR
00B8 E0                MOVX    A,@DPTR
00B9 FD                MOV     R5,A
00BA A3                INC     DPTR
00BB E0                MOVX    A,@DPTR
00BC FE                MOV     R6,A
00BD A3                INC     DPTR
00BE E0                MOVX    A,@DPTR
00BF FF                MOV     R7,A
00C0 120000      E     LCALL   ?C?FPSUB
                                           ; SOURCE LINE # 95
00C3         ?C0008:
00C3 22                RET     
             ; FUNCTION _navError (END)

             ; FUNCTION _navIControl (BEGIN)
                                           ; SOURCE LINE # 99
0000 900000      R     MOV     DPTR,#dT
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 100
0006 900000      R     MOV     DPTR,#navintegralSum
0009 E0                MOVX    A,@DPTR
000A FC                MOV     R4,A
000B A3                INC     DPTR
000C E0                MOVX    A,@DPTR
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 12  

000D FD                MOV     R5,A
000E A3                INC     DPTR
000F E0                MOVX    A,@DPTR
0010 FE                MOV     R6,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 FF                MOV     R7,A
0014 C004              PUSH    AR4
0016 C005              PUSH    AR5
0018 C006              PUSH    AR6
001A C007              PUSH    AR7
001C 900000      R     MOV     DPTR,#dT
001F E0                MOVX    A,@DPTR
0020 FC                MOV     R4,A
0021 A3                INC     DPTR
0022 E0                MOVX    A,@DPTR
0023 FD                MOV     R5,A
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 FE                MOV     R6,A
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 FF                MOV     R7,A
002A 900000      R     MOV     DPTR,#error
002D E0                MOVX    A,@DPTR
002E F8                MOV     R0,A
002F A3                INC     DPTR
0030 E0                MOVX    A,@DPTR
0031 F9                MOV     R1,A
0032 A3                INC     DPTR
0033 E0                MOVX    A,@DPTR
0034 FA                MOV     R2,A
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 FB                MOV     R3,A
0038 120000      E     LCALL   ?C?FPMUL
003B A804              MOV     R0,AR4
003D A905              MOV     R1,AR5
003F AA06              MOV     R2,AR6
0041 AB07              MOV     R3,AR7
0043 D007              POP     AR7
0045 D006              POP     AR6
0047 D005              POP     AR5
0049 D004              POP     AR4
004B 120000      E     LCALL   ?C?FPADD
004E 900000      R     MOV     DPTR,#navintegralSum
0051 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 101
0054         ?C0009:
0054 22                RET     
             ; FUNCTION _navIControl (END)

             ; FUNCTION _navDControl (BEGIN)
                                           ; SOURCE LINE # 105
0000 900000      R     MOV     DPTR,#time
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 106
0006 900000      R     MOV     DPTR,#navprevTime
0009 E0                MOVX    A,@DPTR
000A F8                MOV     R0,A
000B A3                INC     DPTR
000C E0                MOVX    A,@DPTR
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 13  

000D F9                MOV     R1,A
000E A3                INC     DPTR
000F E0                MOVX    A,@DPTR
0010 FA                MOV     R2,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 FB                MOV     R3,A
0014 900000      R     MOV     DPTR,#time
0017 E0                MOVX    A,@DPTR
0018 FC                MOV     R4,A
0019 A3                INC     DPTR
001A E0                MOVX    A,@DPTR
001B FD                MOV     R5,A
001C A3                INC     DPTR
001D E0                MOVX    A,@DPTR
001E FE                MOV     R6,A
001F A3                INC     DPTR
0020 E0                MOVX    A,@DPTR
0021 FF                MOV     R7,A
0022 120000      E     LCALL   ?C?FPSUB
0025 C004              PUSH    AR4
0027 C005              PUSH    AR5
0029 C006              PUSH    AR6
002B C007              PUSH    AR7
002D 900000      R     MOV     DPTR,#navprevError
0030 E0                MOVX    A,@DPTR
0031 F8                MOV     R0,A
0032 A3                INC     DPTR
0033 E0                MOVX    A,@DPTR
0034 F9                MOV     R1,A
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 FA                MOV     R2,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A FB                MOV     R3,A
003B 900000      R     MOV     DPTR,#navthisError
003E E0                MOVX    A,@DPTR
003F FC                MOV     R4,A
0040 A3                INC     DPTR
0041 E0                MOVX    A,@DPTR
0042 FD                MOV     R5,A
0043 A3                INC     DPTR
0044 E0                MOVX    A,@DPTR
0045 FE                MOV     R6,A
0046 A3                INC     DPTR
0047 E0                MOVX    A,@DPTR
0048 FF                MOV     R7,A
0049 120000      E     LCALL   ?C?FPSUB
004C D003              POP     AR3
004E D002              POP     AR2
0050 D001              POP     AR1
0052 D000              POP     AR0
0054 120000      E     LCALL   ?C?FPDIV
0057 900000      R     MOV     DPTR,#dD
005A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 107
005D 900000      R     MOV     DPTR,#dD
0060 E0                MOVX    A,@DPTR
0061 FC                MOV     R4,A
0062 A3                INC     DPTR
0063 E0                MOVX    A,@DPTR
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 14  

0064 FD                MOV     R5,A
0065 A3                INC     DPTR
0066 E0                MOVX    A,@DPTR
0067 FE                MOV     R6,A
0068 A3                INC     DPTR
0069 E0                MOVX    A,@DPTR
006A FF                MOV     R7,A
                                           ; SOURCE LINE # 108
006B         ?C0010:
006B 22                RET     
             ; FUNCTION _navDControl (END)

             ; FUNCTION _navPIDControl (BEGIN)
                                           ; SOURCE LINE # 112
0000 900000      R     MOV     DPTR,#time
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 114
0006 7F00              MOV     R7,#00H
0008 7E00              MOV     R6,#00H
000A 7D7A              MOV     R5,#07AH
000C 7C44              MOV     R4,#044H
000E 900000      R     MOV     DPTR,#periodPWM
0011 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 115
0014 7F00              MOV     R7,#00H
0016 7E00              MOV     R6,#00H
0018 7D16              MOV     R5,#016H
001A 7C43              MOV     R4,#043H
001C 900000      R     MOV     DPTR,#openLoop
001F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 116
0022 7F00              MOV     R7,#00H
0024 7E00              MOV     R6,#00H
0026 7D70              MOV     R5,#070H
0028 7C41              MOV     R4,#041H
002A 900000      R     MOV     DPTR,#navKp
002D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 117
0030 7F00              MOV     R7,#00H
0032 7E00              MOV     R6,#00H
0034 7D00              MOV     R5,#00H
0036 7C00              MOV     R4,#00H
0038 900000      R     MOV     DPTR,#navKi
003B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 118
003E 7F00              MOV     R7,#00H
0040 7E00              MOV     R6,#00H
0042 7DE0              MOV     R5,#0E0H
0044 7C40              MOV     R4,#040H
0046 900000      R     MOV     DPTR,#navKd
0049 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 119
004C 900000      R     MOV     DPTR,#time
004F E0                MOVX    A,@DPTR
0050 FC                MOV     R4,A
0051 A3                INC     DPTR
0052 E0                MOVX    A,@DPTR
0053 FD                MOV     R5,A
0054 A3                INC     DPTR
0055 E0                MOVX    A,@DPTR
0056 FE                MOV     R6,A
0057 A3                INC     DPTR
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 15  

0058 E0                MOVX    A,@DPTR
0059 FF                MOV     R7,A
005A 120000      R     LCALL   _navError
005D 900000      R     MOV     DPTR,#error
0060 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 122
0063 900000      R     MOV     DPTR,#error
0066 E0                MOVX    A,@DPTR
0067 FC                MOV     R4,A
0068 A3                INC     DPTR
0069 E0                MOVX    A,@DPTR
006A FD                MOV     R5,A
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D FE                MOV     R6,A
006E A3                INC     DPTR
006F E0                MOVX    A,@DPTR
0070 FF                MOV     R7,A
0071 900000      R     MOV     DPTR,#navKp
0074 E0                MOVX    A,@DPTR
0075 F8                MOV     R0,A
0076 A3                INC     DPTR
0077 E0                MOVX    A,@DPTR
0078 F9                MOV     R1,A
0079 A3                INC     DPTR
007A E0                MOVX    A,@DPTR
007B FA                MOV     R2,A
007C A3                INC     DPTR
007D E0                MOVX    A,@DPTR
007E FB                MOV     R3,A
007F 120000      E     LCALL   ?C?FPMUL
0082 7B00              MOV     R3,#00H
0084 7A50              MOV     R2,#050H
0086 79C3              MOV     R1,#0C3H
0088 7847              MOV     R0,#047H
008A 120000      E     LCALL   ?C?FPMUL
008D A804              MOV     R0,AR4
008F A905              MOV     R1,AR5
0091 AA06              MOV     R2,AR6
0093 AB07              MOV     R3,AR7
0095 900000      R     MOV     DPTR,#openLoop
0098 E0                MOVX    A,@DPTR
0099 FC                MOV     R4,A
009A A3                INC     DPTR
009B E0                MOVX    A,@DPTR
009C FD                MOV     R5,A
009D A3                INC     DPTR
009E E0                MOVX    A,@DPTR
009F FE                MOV     R6,A
00A0 A3                INC     DPTR
00A1 E0                MOVX    A,@DPTR
00A2 FF                MOV     R7,A
00A3 120000      E     LCALL   ?C?FPSUB
00A6 C004              PUSH    AR4
00A8 C005              PUSH    AR5
00AA C006              PUSH    AR6
00AC C007              PUSH    AR7
00AE 900000      R     MOV     DPTR,#navintegralSum
00B1 E0                MOVX    A,@DPTR
00B2 FC                MOV     R4,A
00B3 A3                INC     DPTR
00B4 E0                MOVX    A,@DPTR
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 16  

00B5 FD                MOV     R5,A
00B6 A3                INC     DPTR
00B7 E0                MOVX    A,@DPTR
00B8 FE                MOV     R6,A
00B9 A3                INC     DPTR
00BA E0                MOVX    A,@DPTR
00BB FF                MOV     R7,A
00BC 900000      R     MOV     DPTR,#navKi
00BF E0                MOVX    A,@DPTR
00C0 F8                MOV     R0,A
00C1 A3                INC     DPTR
00C2 E0                MOVX    A,@DPTR
00C3 F9                MOV     R1,A
00C4 A3                INC     DPTR
00C5 E0                MOVX    A,@DPTR
00C6 FA                MOV     R2,A
00C7 A3                INC     DPTR
00C8 E0                MOVX    A,@DPTR
00C9 FB                MOV     R3,A
00CA 120000      E     LCALL   ?C?FPMUL
00CD A804              MOV     R0,AR4
00CF A905              MOV     R1,AR5
00D1 AA06              MOV     R2,AR6
00D3 AB07              MOV     R3,AR7
00D5 D007              POP     AR7
00D7 D006              POP     AR6
00D9 D005              POP     AR5
00DB D004              POP     AR4
00DD 120000      E     LCALL   ?C?FPADD
00E0 900000      R     MOV     DPTR,#cmp
00E3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 125
00E6 7F00              MOV     R7,#00H
00E8 7E00              MOV     R6,#00H
00EA 7DDC              MOV     R5,#0DCH
00EC 7C42              MOV     R4,#042H
00EE 900000      R     MOV     DPTR,#cmp
00F1 E0                MOVX    A,@DPTR
00F2 F8                MOV     R0,A
00F3 A3                INC     DPTR
00F4 E0                MOVX    A,@DPTR
00F5 F9                MOV     R1,A
00F6 A3                INC     DPTR
00F7 E0                MOVX    A,@DPTR
00F8 FA                MOV     R2,A
00F9 A3                INC     DPTR
00FA E0                MOVX    A,@DPTR
00FB FB                MOV     R3,A
00FC 120000      E     LCALL   ?C?FPCMP3
00FF 5010              JNC     ?C0011
0101 7F00              MOV     R7,#00H
0103 7E00              MOV     R6,#00H
0105 7DDC              MOV     R5,#0DCH
0107 7C42              MOV     R4,#042H
0109 900000      R     MOV     DPTR,#cmp
010C 120000      E     LCALL   ?C?LSTXDATA
010F 802B              SJMP    ?C0012
0111         ?C0011:
                                           ; SOURCE LINE # 126
0111 7F00              MOV     R7,#00H
0113 7E00              MOV     R6,#00H
0115 7D3E              MOV     R5,#03EH
C51 COMPILER V9.03   NAVIGATION                                                            04/04/2015 14:31:37 PAGE 17  

0117 7C43              MOV     R4,#043H
0119 900000      R     MOV     DPTR,#cmp
011C E0                MOVX    A,@DPTR
011D F8                MOV     R0,A
011E A3                INC     DPTR
011F E0                MOVX    A,@DPTR
0120 F9                MOV     R1,A
0121 A3                INC     DPTR
0122 E0                MOVX    A,@DPTR
0123 FA                MOV     R2,A
0124 A3                INC     DPTR
0125 E0                MOVX    A,@DPTR
0126 FB                MOV     R3,A
0127 120000      E     LCALL   ?C?FPCMP3
012A 6010              JZ      ?C0012
012C 400E              JC      ?C0012
012E 7F00              MOV     R7,#00H
0130 7E00              MOV     R6,#00H
0132 7D3E              MOV     R5,#03EH
0134 7C43              MOV     R4,#043H
0136 900000      R     MOV     DPTR,#cmp
0139 120000      E     LCALL   ?C?LSTXDATA
013C         ?C0013:
013C         ?C0012:
                                           ; SOURCE LINE # 129
013C 900000      R     MOV     DPTR,#cmp
013F E0                MOVX    A,@DPTR
0140 FC                MOV     R4,A
0141 A3                INC     DPTR
0142 E0                MOVX    A,@DPTR
0143 FD                MOV     R5,A
0144 A3                INC     DPTR
0145 E0                MOVX    A,@DPTR
0146 FE                MOV     R6,A
0147 A3                INC     DPTR
0148 E0                MOVX    A,@DPTR
0149 FF                MOV     R7,A
014A 120000      E     LCALL   ?C?CASTF
                                           ; SOURCE LINE # 130
014D         ?C0014:
014D 22                RET     
             ; FUNCTION _navPIDControl (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1219    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    113    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
